generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model School {
  id        String    @id @default(uuid())
  name      String
  planType  String    @default("PRO") // BASIC, PRO, ENTERPRISE
  students  Student[]
  employees Employee[]
  inventory InventoryItem[]
  createdAt DateTime  @default(now())
}

model Student {
  id          String   @id @default(uuid())
  name        String
  birthDate   DateTime?
  status      String   @default("ACTIVE") // ACTIVE, INACTIVE, EVADED
  
  // DADOS FLEXÍVEIS
  healthData  Json?
  academicData Json?
  attendance   Json?

  documents   Document[]
  schoolId    String
  school      School   @relation(fields: [schoolId], references: [id])
  classId     String?
}

model Employee {
  id        String   @id @default(uuid())
  name      String
  role      String   // Professor, Nutricionista, Zelador, Coordenador
  email     String?
  phone     String?
  status    String   @default("ACTIVE")
  
  documents Document[]
  schoolId  String
  school    School   @relation(fields: [schoolId], references: [id])
  createdAt DateTime @default(now())
}

model Document {
  id          String   @id @default(uuid())
  type        String   // RG, CONTRATO, FOTO, VACINA, DIPLOMA
  url         String   // Caminho do arquivo
  filename    String
  fileSize    Int?     // Tamanho em bytes
  mimeType    String?  // application/pdf, image/jpeg
  
  studentId   String?
  student     Student? @relation(fields: [studentId], references: [id], onDelete: Cascade)
  employeeId  String?
  employee    Employee? @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model InventoryItem {
  id           String   @id @default(uuid())
  name         String
  category     String   // HIGIENE, PEDAGOGICO, ALIMENTACAO
  quantity     Int
  minThreshold Int      @default(10)
  unit         String   @default("un")
  
  // Campos de Compras
  sku          String?  // Código do fornecedor
  lastPrice    Decimal? @default(0.0)
  supplier     String?  // Nome do fornecedor
  lastUpdated  DateTime @default(now())
  
  schoolId     String
  school       School   @relation(fields: [schoolId], references: [id])
}

model ProcurementOrder {
  id          String   @id @default(uuid())
  orderNumber String   @unique
  status      String   @default("DRAFT") // DRAFT, PENDING, APPROVED, COMPLETED
  
  items       ProcurementItem[]
  totalValue  Decimal  @default(0.0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ProcurementItem {
  id        String   @id @default(uuid())
  quantity  Int
  unitPrice Decimal
  subtotal  Decimal
  
  orderId   String
  order     ProcurementOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  itemName  String
  itemSku   String?
}
